# Annotations & Markers 功能使用指南

## 功能概述

WaveformViewer 现在支持在波形图上添加标注（Annotations）和标记（Markers），用于标记重要的时间点或区域。标注数据会自动保存到后端，与数据集关联。

## 功能特性

### 1. 标注类型

#### Marker（标记点）

- 在波形图上标记单个时间点
- 显示为垂直线，横跨所有通道
- 可自定义颜色和标签

#### Region（区域）

- 标记一段时间范围
- 显示为半透明区域，横跨所有通道
- 可自定义颜色和标签

### 2. 标注属性

每个标注支持以下属性：

- **类型** (type): `marker` 或 `region`
- **时间** (time): 标记点的时间位置（仅 marker）
- **开始时间** (startTime): 区域的开始时间（仅 region）
- **结束时间** (endTime): 区域的结束时间（仅 region）
- **标签** (label): 标注名称（必填）
- **颜色** (color): 标注颜色（可选，默认 #FF5722）
- **描述** (description): 标注详细描述（可选）

## 使用方法

### 添加标注

1. 点击页面右上角的 "添加标注" 按钮
2. 在弹出的对话框中选择标注类型（标记点或区域）
3. 输入时间信息（标记点输入单个时间，区域输入开始和结束时间）
4. 输入标签名称
5. 选择颜色（可选）
6. 输入描述信息（可选）
7. 点击"保存"按钮

### 查看标注列表

1. 点击页面右下角的浮动按钮（显示标注数量徽章）
2. 侧边抽屉会显示所有标注的列表
3. 每个标注卡片显示：
   - 标签名称和颜色指示器
   - 时间信息
   - 描述信息（如果有）

### 编辑标注

1. 在标注列表中找到要编辑的标注
2. 点击标注卡片右上角的编辑图标（铅笔）
3. 在弹出的对话框中修改标注信息
4. 点击"保存"按钮

### 删除标注

1. 在标注列表中找到要删除的标注
2. 点击标注卡片右上角的删除图标（垃圾桶）
3. 在确认对话框中点击"删除"按钮

## 后端 API

### 获取标注列表

```
GET /api/datasets/:id/annotations
```

返回指定数据集的所有标注。

### 创建标注

```
POST /api/datasets/:id/annotations
Content-Type: application/json

{
  "type": "marker",
  "time": 100.5,
  "label": "故障点",
  "color": "#FF5722FF",
  "description": "这是一个示例标注"
}
```

### 更新标注

```
PUT /api/datasets/:id/annotations/:annId
Content-Type: application/json

{
  "type": "marker",
  "time": 105.0,
  "label": "更新后的标签",
  "color": "#2196F3FF",
  "description": "更新后的描述"
}
```

### 删除标注

```
DELETE /api/datasets/:id/annotations/:annId
```

## 数据存储

标注数据以 JSON 格式存储在每个数据集目录下的 `annotations.json` 文件中。

示例：

```json
[
  {
    "id": "1737551234567890123",
    "type": "marker",
    "time": 100.5,
    "label": "故障点",
    "color": "#FF5722FF",
    "description": "检测到故障"
  },
  {
    "id": "1737551234567890124",
    "type": "region",
    "startTime": 200.0,
    "endTime": 300.0,
    "label": "恢复期",
    "color": "#4CAF50FF",
    "description": "系统恢复阶段"
  }
]
```

## 技术实现

### 前端

- 使用 ECharts 的 `markLine` 显示标记点
- 使用 ECharts 的 `markArea` 显示区域
- 使用 Naive UI 组件构建用户界面
- 标注数据通过 Pinia store 管理（可选）
- 与后端 API 通信进行 CRUD 操作

### 后端

- Go + Gin 框架
- JSON 文件存储
- RESTful API 设计
- 自动生成唯一 ID（基于时间戳）

## 最佳实践

1. **命名标注**: 使用清晰、描述性的标签名称
2. **颜色选择**: 为不同类型的事件使用不同的颜色
3. **添加描述**: 为重要标注添加详细描述，方便后续查看
4. **区域标注**: 对于持续性事件，使用区域标注而不是多个点标注
5. **定期整理**: 删除不再需要的标注，保持列表整洁

## 未来改进

- [ ] 支持拖拽调整标注位置
- [ ] 支持标注模板
- [ ] 支持标注导出/导入
- [ ] 支持标注搜索和过滤
- [ ] 支持标注分组
- [ ] 支持标注快捷键
